{"version":3,"sources":["squareframe.js"],"names":["disList","theScore","hScore","cc","Class","extends","Component","properties","sideNum","sideLength","framePic","default","type","SpriteFrame","failPrefab","Prefab","checkElimination","argument","addScore","curFKLen","haveSquareIndexList","i","frameList","length","isHaveFK","push","SquareIndex","sort","a","b","eliminationList","oneXCList","intersectAry","get2AryIntersect","isXC","check2AryIsEqual","actionAry","self","count","oneList","j","xIndex","callFunc","arguments","FKNode","getChildByName","runAction","sequence","spawn","scaleTo","fadeOut","removeSelf","delayTime","isDeleting","checkIsLose","action","node","find","script","getComponent","opacity","failNode","instantiate","parent","addChild","oldScore","FBInstant","player","getDataAsync","then","data","setDataAsync","getLeaderboardAsync","leaderboard","setScoreAsync","console","log","catch","error","XCCount","isDropAdd","addScoreCount","getAddScoreCal","label","Label","string","Number","x","ary1","ary2","onLoad","view","enableRetina","resizeWithBrowserSize","srcPos","v2","y","fPosList","oVec","zeroPos","add","fPos","Node","sprite","addComponent","Sprite","spriteFrame","sizeMode","SizeMode","CUSTOM","width","height","on"],"mappings":"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","file":"squareframe.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\nconst disList = [\r\n    [0,1,2,3,4,5,6,7],\r\n    [8,9,10,11,12,13,14,15],\r\n    [16,17,18,19,20,21,22,23],\r\n    [24,25,26,27,28,29,30,31],\r\n    [32,33,34,35,36,37,38,39],\r\n    [40,41,42,43,44,45,46,47],\r\n    [48,49,50,51,52,53,54,55],\r\n    [56,57,58,59,60,61,62,63],\r\n\r\n    [0,8,16,24,32,40,48,56],\r\n    [1,9,17,25,33,41,49,57],\r\n    [2,10,18,26,34,42,50,58],\r\n    [3,11,19,27,35,43,51,59],\r\n    [4,12,20,27,36,44,52,60],\r\n    [5,13,21,29,37,45,53,61],\r\n    [6,14,22,30,38,46,54,62],\r\n    [7,15,23,31,39,47,55,63]\r\n]\r\n\r\nvar theScore = 0\r\nvar hScore = 0\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n        sideNum:8,\r\n        sideLength:0,\r\n        framePic:{\r\n            default:null,\r\n            type:cc.SpriteFrame\r\n        },\r\n        failPrefab:{\r\n            default:null,\r\n            type:cc.Prefab\r\n        },\r\n    },\r\n\r\n    // 消除\r\n    checkElimination: function(argument) {\r\n        this.addScore(this.curFKLen, true)\r\n\r\n        var haveSquareIndexList = [];\r\n        for (var i = 0; i < this.frameList.length; i++) {\r\n            if(this.frameList[i].isHaveFK){\r\n                haveSquareIndexList.push(this.frameList[i].SquareIndex);\r\n            }\r\n            \r\n        }\r\n\r\n        haveSquareIndexList.sort(function(a, b){return a - b});\r\n        var eliminationList = [];//要消除的方块列表\r\n        for (var i = 0; i < disList.length; i++) {\r\n            var oneXCList = disList[i];\r\n            var intersectAry = this.get2AryIntersect(haveSquareIndexList, oneXCList);\r\n\r\n\r\n            if(intersectAry.length > 0){\r\n                //cc.log(\"intersectAry:\", intersectAry.toString())\r\n                //cc.log(\"oneXCList:\", oneXCList.toString())\r\n\r\n                var isXC = this.check2AryIsEqual(oneXCList, intersectAry);\r\n\r\n                //cc.log(\"intersectAry 和 oneXCList是否相等：\", isXC)\r\n                if(isXC){\r\n                    eliminationList.push(oneXCList);\r\n                }\r\n            }\r\n        }\r\n\r\n        var actionAry = [];\r\n        var self = this;\r\n        //消除\r\n        var count = 0;\r\n        for (var i = 0; i < eliminationList.length; i++) {\r\n\r\n            var oneList = eliminationList[i];\r\n            for (var j = 0; j < oneList.length; j++) {\r\n                var xIndex = oneList[j];\r\n\r\n                actionAry.push(cc.callFunc(function(){\r\n                    var xIndex = arguments[1];\r\n                    this.frameList[xIndex].isHaveFK = null;\r\n\r\n                    var FKNode = this.frameList[xIndex].getChildByName(\"colorSpr\");\r\n                    if (!FKNode) {\r\n                        return;\r\n                    }\r\n\r\n                    FKNode.runAction(cc.sequence(\r\n                        cc.spawn(cc.scaleTo(0.5, 2), cc.fadeOut(0.5)),\r\n                        cc.removeSelf(true)\r\n                    ));\r\n                    \r\n                }, this, xIndex));\r\n\r\n                actionAry.push(cc.delayTime(0.05));\r\n\r\n                count++;\r\n            }\r\n            \r\n        }\r\n\r\n        if (actionAry.length > 0) {\r\n            actionAry.push(cc.callFunc(function(){\r\n                this.isDeleting = false;\r\n                this.checkIsLose();\r\n            }, this));\r\n\r\n            this.isDeleting = true;\r\n            var action = cc.sequence(actionAry);\r\n            this.node.runAction(action);\r\n\r\n            this.addScore(count)\r\n        }\r\n    },\r\n\r\n    //检测是不是输了\r\n    checkIsLose: function() {\r\n        //如果正在消除中，那就不判断输赢，因为消除后会再判断\r\n        if (this.isDeleting) return\r\n\r\n        var count = 0\r\n        for (var i = 0; i < 3; i++) {\r\n            var node = cc.find('Canvas/get_square_' + (i + 1))\r\n            var script = node.getComponent('square')\r\n            if(script.checkIsLose()){\r\n                \r\n                //cc.log(\"方块\" + (i + 1) + \"已经无处安放\")\r\n                count++\r\n                node.opacity = 125\r\n            }\r\n            else{\r\n\r\n                //cc.log(\"方块\" + (i + 1) + \"可以安放\")\r\n                node.opacity = 255\r\n            }\r\n            \r\n        }\r\n\r\n        if (count == 3) {\r\n            var failNode = cc.instantiate(this.failPrefab)\r\n            this.node.parent.addChild(failNode)\r\n\r\n            var oldScore = 0\r\n            FBInstant.player.getDataAsync(['hScore']).then(function(data){\r\n                oldScore = data['hScore']\r\n                if (oldScore < theScore) {\r\n                    FBInstant.player.setDataAsync({hScore : theScore}).then(\r\n                        FBInstant.getLeaderboardAsync('eliminateRank') .then(leaderboard => {\r\n                            return leaderboard.setScoreAsync(theScore)\r\n                        }).then(() => console.log('Score saved')).catch(error => console.error(error))\r\n                    )\r\n                }\r\n            })\r\n        }\r\n\r\n    },\r\n\r\n    //加分，参数是消除的总数,isDropAdd是是否是放下的单纯加分\r\n    addScore: function(XCCount, isDropAdd) {\r\n        var addScoreCount = this.getAddScoreCal(XCCount, isDropAdd)\r\n        var node = cc.find('Canvas/scores/score/scoreLabel')\r\n        var label = node.getComponent(cc.Label)\r\n\r\n        label.string = addScoreCount + Number(label.string)\r\n        theScore = Number(label.string)\r\n    },\r\n\r\n    //计算加分的公式\r\n    getAddScoreCal: function(XCCount, isDropAdd) {\r\n        var x = XCCount + 1\r\n        var addScoreCount = isDropAdd ? x : 2 * x//数量的平方\r\n        return addScoreCount\r\n    },\r\n\r\n    // 获得两个数组的交集\r\n    get2AryIntersect: function(ary1, ary2) {\r\n        var intersectAry = [];\r\n        for (var i = 0; i < ary1.length; i++) {\r\n            for (var j = 0; j < ary2.length; j++) {\r\n                // cc.log(ary1[i] + \" \" + ary2[j]);\r\n                if(ary2[j] == ary1[i]){\r\n                    intersectAry.push(ary2[j]);\r\n                }\r\n            }\r\n        }\r\n\r\n        return intersectAry;\r\n    },\r\n\r\n    // 检查两数组是否相同\r\n    check2AryIsEqual: function(ary1, ary2) {\r\n        for (var i = 0; i < ary1.length; i++) {\r\n            if(ary2[i] != ary1[i]){\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad:function() {\r\n        cc.view.enableRetina(true);\r\n        cc.view.resizeWithBrowserSize(true);\r\n\r\n        var srcPos = cc.v2(this.node.x, this.node.y);\r\n        var frameList = [];\r\n        var fPosList = [];\r\n        var oVec = cc.v2(-(this.sideLength * 7) / 2, (this.sideLength * 7) / 2);\r\n        var zeroPos = srcPos.add(oVec);\r\n\r\n        //生成位置列表\r\n        for (let i = 0; i < this.sideNum; i++) {\r\n            for (let j = 0; j < this.sideNum; j++) {\r\n                var fPos = zeroPos.add(cc.v2(i * this.sideLength, -(j * this.sideLength)));\r\n                fPosList.push(fPos);\r\n            }\r\n        }\r\n\r\n        //初始化框架\r\n        for (let i = 0; i < fPosList.length; i++) {\r\n            var node = new cc.Node(\"frame\");\r\n            var sprite = node.addComponent(cc.Sprite);\r\n            sprite.spriteFrame = this.framePic;\r\n            sprite.sizeMode = cc.Sprite.SizeMode.CUSTOM;\r\n            \r\n            node.width = this.sideLength;\r\n            node.height= this.sideLength;\r\n\r\n            node.x = fPosList[i].x;\r\n            node.y = fPosList[i].y;\r\n            \r\n            node.parent = this.node;\r\n            \r\n            node.SquareIndex = i;\r\n\r\n            frameList.push(node);\r\n        }\r\n\r\n        this.frameList = frameList;\r\n        this.fPosList = fPosList;\r\n        this.isDeleting = false;//判断是否正在消除的依据\r\n\r\n        //监听成功放下事件\r\n        this.node.on('succDropDownOne', this.checkElimination, this);\r\n        //初始化历史最高分\r\n        FBInstant.player.getDataAsync(['hScore']).then(function(data){\r\n            hScore = data['hScore']\r\n            var node = cc.find('Canvas/scores/highScore/scoreLabel')\r\n            var label = node.getComponent(cc.Label)\r\n            if(hScore > 0){\r\n                label.string = hScore\r\n            } \r\n        })\r\n    },\r\n\r\n    // start () {\r\n\r\n    // },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}